{
  "id": "klmMGlYACRbiS7oA7.8AISgWcQA",
  "name": "ORS Daily Discharge List",
  "description": "This report shows all scheduled movements out of a prison (court movements, confirmed releases, approved transfers, all approved temporary absences) for a date range specified at runtime. The data is grouped by date, movement type, destination name and surname.<br/>MOV0023 - v1.2 Last Modified: 20/08/2019",
  "metadata": {
    "version": "1.0.0",
    "tags": ["MOV0023 v1.2 DPR"]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP3",
      "name": "Discharges",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, SUBSTR(AT_OFFENDER.FIRST_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME_2 IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME_2, 1, 1) || '.' END END AS INITIALS, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, CASE WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'ADM' THEN 'Admission' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'ADMIN' THEN 'Administrative' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'CRI' THEN 'Community Report In' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'CRT' THEN 'Court' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'INT' THEN 'Internal Transfer' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'INTAKE' THEN 'Intake' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'INTER' THEN 'Intermittent Custody' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'OJ' THEN 'Outside Jurisdication' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'REL' THEN 'Release' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'TAP' THEN 'Temporary Absence/Home Leave' WHEN AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'TRN' THEN 'Transfers' ELSE AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE END AS EVENT_TYPE_DESCRIPTION, AT_OFFENDER_IND_SCHEDULES.EVENT_DATE AS EVENT_DATE, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'HH24:MI') AS FORMATTED_EVENT_START_TIME, ScheduledMovementReason.DESCRIPTION AS DESCRIPTION, CASE WHEN NOT AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL THEN AT_AGENCY_LOCATIONS_SCH_TO.DESCRIPTION WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND NOT AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL AND DT_ROTL_ADDRESS_USAGE.ADDRESS_USAGE = 'ROTL' THEN CASE WHEN (ROTL_ADDRESSES.FLAT) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.FLAT) END || ' ' || CASE WHEN (ROTL_ADDRESSES.PREMISE) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.PREMISE) || ' ' END || CASE WHEN (ROTL_ADDRESSES.STREET) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.STREET) || ' ' END WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL THEN 'No Location' ELSE AT_CORPORATES.CORPORATE_NAME END AS SCHEDULED_MOVEMENT_DESTINATION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_DATE, AT_OFFENDER_IND_SCHEDULES.EVENT_SUB_TYPE AS EVENT_SUB_TYPE, AT_OFFENDER_IND_SCHEDULES.EVENT_STATUS AS EVENT_STATUS, AT_OFFENDER_IND_SCHEDULES.ESCORT_CODE AS ESCORT_CODE, DT_PROPERTY_BOXES.SEAL_MARK AS SEAL_MARK, AT_ALERT_TYPE_DESC.DESCRIPTION AS ALERT_DESCRIPTION, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_RELIGION.PROFILE_CODE AS PROFILE_CODE, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT AS APPROVED_RESULT FROM ADDRESSES ROTL_ADDRESSES, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_IND_SCHEDULES AT_OFFENDER_IND_SCHEDULES, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES ScheduledMovementReason, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_TO, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM2, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.CORPORATES AT_CORPORATES, ( SELECT * FROM ADDRESS_USAGES WHERE ADDRESS_USAGE = 'ROTL' ) DT_ROTL_ADDRESS_USAGE, ( SELECT Offender_Book_ID, Property_Container_ID, Active_Flag, Seal_Mark, Agy_Loc_ID, Expiry_Date, Internal_Location_ID, PROPOSED_DISPOSAL_DATE, Container_Code, Property_Only_Flag, Comment_Text FROM oms_owner.offender_ppty_containers WHERE active_flag = 'Y' AND Agy_Loc_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) DT_PROPERTY_BOXES, ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM ( SELECT v.*, rc.description AS coalesced_result_description FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT( CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END ) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM ( SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE( oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type ) AS coalesced_result, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_latest, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y' ) ) ) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE' ) ) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES, V_CORPORATE_ADDRESSES AT_V_CORPORATE_ADDRESSES, ADDRESSES AT_CORPORATE_ADDRESSES WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE (+) = 'RELF') AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_IND_SCHEDULES.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE ) AND ( AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_IND_SCHEDULES.EVENT_SUB_TYPE = ScheduledMovementReason.CODE ) AND (ScheduledMovementReason.DOMAIN = 'MOVE_RSN') AND ( AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_TO.AGY_LOC_ID (+) ) AND ( AT_OFFENDER_IND_SCHEDULES.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID (+) ) AND ( AT_AGENCY_LOCATIONS_SCH_FROM2.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CORPORATE_ADDRESSES.ADDRESS_ID = AT_V_CORPORATE_ADDRESSES.ADDRESS_ID (+) ) AND ( AT_V_CORPORATE_ADDRESSES.CORPORATE_ID = AT_CORPORATES.CORPORATE_ID (+) ) AND ( AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = AT_CORPORATE_ADDRESSES.ADDRESS_ID (+) ) AND ( AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = ROTL_ADDRESSES.ADDRESS_ID (+) ) AND ( AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = DT_ROTL_ADDRESS_USAGE.ADDRESS_ID (+) ) AND ( AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_PROPERTY_BOXES.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID (+) ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_AGENCY_LOCATIONS_SCH_FROM2.AGENCY_LOCATION_TYPE = 'INST' AND AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Scheduled TAPS, Transfers and Appointments\\Scheduled Departure Establishment Code',mono,free,,Not_Persistent,,User:2) */ ) ) AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE >= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date Start','D',,Mono,Free,Not_Persistent,,User:4) */ ) AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE <= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date End','D',,Mono,Free,Not_Persistent,,User:5) */ ) AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE >= TRUNC(CURRENT_TIMESTAMP) AND ( DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL ) AND AT_OFFENDER_IND_SCHEDULES.DIRECTION_CODE = 'OUT' AND AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE IN ('TAP', 'TRN') AND AT_OFFENDER_IND_SCHEDULES.EVENT_CLASS = 'EXT_MOV' AND AT_OFFENDER_IND_SCHEDULES.EVENT_STATUS = 'SCH' ) UNION SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, SUBSTR(AT_OFFENDER.FIRST_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME_2 IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME_2, 1, 1) || '.' END END AS INITIALS, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, 'Release' AS EVENT_TYPE_DESCRIPTION, AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE AS EVENT_DATE, '' AS FORMATTED_EVENT_START_TIME, AT_RELEASE_REASON.DESCRIPTION AS DESCRIPTION, '- ' AS SCHEDULED_MOVEMENT_DESTINATION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_DATE, 'Release' AS EVENT_SUB_TYPE, AT_OFFENDER_RELEASE_DETAILS.EVENT_STATUS AS EVENT_STATUS, '' AS ESCORT_CODE, DT_PROPERTY_BOXES.SEAL_MARK AS SEAL_MARK, AT_ALERT_TYPE_DESC.DESCRIPTION AS ALERT_DESCRIPTION, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_RELIGION.PROFILE_CODE AS PROFILE_CODE, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT AS APPROVED_RESULT FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES AT_RELEASE_REASON, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, ( SELECT Offender_Book_ID, Property_Container_ID, Active_Flag, Seal_Mark, Agy_Loc_ID, Expiry_Date, Internal_Location_ID, PROPOSED_DISPOSAL_DATE, Container_Code, Property_Only_Flag, Comment_Text FROM oms_owner.offender_ppty_containers WHERE active_flag = 'Y' AND Agy_Loc_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) DT_PROPERTY_BOXES, ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM ( SELECT v.*, rc.description AS coalesced_result_description FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT( CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END ) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM ( SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE( oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type ) AS coalesced_result, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_latest, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y' ) ) ) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE' ) ) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE (+) = 'RELF') AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE ) AND ( AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_RELEASE_DETAILS.MOVEMENT_REASON_CODE = AT_RELEASE_REASON.CODE (+) ) AND (AT_RELEASE_REASON.DOMAIN (+) = 'MOVE_RSN') AND (AT_RELEASE_REASON.PARENT_CODE (+) = 'REL') AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_PROPERTY_BOXES.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID (+) ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ AND AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE >= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date Start','D',,Mono,Free,Persistent,,User:0) */ ) AND AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE <= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date End','D',,Mono,Free,Persistent,,User:1) */ ) AND AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE >= TRUNC(CURRENT_TIMESTAMP) AND ( DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL ) AND AT_OFFENDER_RELEASE_DETAILS.EVENT_STATUS IN ('SCH') ) UNION SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, SUBSTR(AT_OFFENDER.FIRST_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME, 1, 1) || '.' || CASE WHEN AT_OFFENDER.MIDDLE_NAME_2 IS NULL THEN NULL ELSE SUBSTR(AT_OFFENDER.MIDDLE_NAME_2, 1, 1) || '.' END END AS INITIALS, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, 'Court Event' AS EVENT_TYPE_DESCRIPTION, AT_COURT_EVENT_MVMTS.EVENT_DATE AS EVENT_DATE, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'HH24:MI') AS FORMATTED_EVENT_START_TIME, CourtMovementReason.DESCRIPTION AS DESCRIPTION, AT_DESTINATION_COURT.DESCRIPTION AS SCHEDULED_MOVEMENT_DESTINATION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_DATE, 'Court' AS EVENT_SUB_TYPE, AT_COURT_EVENT_MVMTS.EVENT_STATUS AS EVENT_STATUS, '' AS ESCORT_CODE, DT_PROPERTY_BOXES.SEAL_MARK AS SEAL_MARK, AT_ALERT_TYPE_DESC.DESCRIPTION AS ALERT_DESCRIPTION, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_RELIGION.PROFILE_CODE AS PROFILE_CODE, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT AS APPROVED_RESULT FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES CourtMovementReason, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_DESTINATION_COURT, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.COURT_EVENTS AT_COURT_EVENT_MVMTS, ( SELECT Offender_Book_ID, Property_Container_ID, Active_Flag, Seal_Mark, Agy_Loc_ID, Expiry_Date, Internal_Location_ID, PROPOSED_DISPOSAL_DATE, Container_Code, Property_Only_Flag, Comment_Text FROM oms_owner.offender_ppty_containers WHERE active_flag = 'Y' AND Agy_Loc_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) DT_PROPERTY_BOXES, ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM ( SELECT v.*, rc.description AS coalesced_result_description FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT( CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END ) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM ( SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE( oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type ) AS coalesced_result, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_latest, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y' ) ) ) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE' ) ) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE (+) = 'RELF') AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE ) AND ( AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND (CourtMovementReason.PARENT_CODE = 'CRT') AND (CourtMovementReason.DOMAIN = 'MOVE_RSN') AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_COURT_EVENT_MVMTS.OFFENDER_BOOK_ID ) AND ( AT_COURT_EVENT_MVMTS.COURT_EVENT_TYPE = CourtMovementReason.CODE ) AND ( AT_COURT_EVENT_MVMTS.AGY_LOC_ID = AT_DESTINATION_COURT.AGY_LOC_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_PROPERTY_BOXES.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID (+) ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_COURT_EVENT_MVMTS.EVENT_DATE >= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date Start','D',,Mono,Free,Persistent,,User:2) */ ) AND AT_COURT_EVENT_MVMTS.EVENT_DATE <= ( SELECT SCHEDULE_DATE FROM prompt_ /* = #prompt('Schedule Date End','D',,Mono,Free,Persistent,,User:3) */ ) AND AT_COURT_EVENT_MVMTS.EVENT_DATE >= TRUNC(CURRENT_TIMESTAMP) AND AT_COURT_EVENT_MVMTS.EVENT_STATUS = 'SCH' AND ( DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL ) AND AT_COURT_EVENT_MVMTS.DIRECTION_CODE = 'OUT' ) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, LAST_NAME, INITIALS, UNIT_DESCRIPTION_4_SHORT, IMPRISONMENT_STATUS, EVENT_TYPE_DESCRIPTION, EVENT_DATE, FORMATTED_EVENT_START_TIME, DESCRIPTION, SCHEDULED_MOVEMENT_DESTINATION, ALERT_CODE, EXPIRY_DATE, ALERT_DATE, EVENT_SUB_TYPE, EVENT_STATUS, ESCORT_CODE, SEAL_MARK, ALERT_DESCRIPTION, ACCT, ALERT_STATUS, PROFILE_CODE, APPROVED_RESULT, CASE WHEN SCHEDULED_MOVEMENT_DESTINATION IS NULL THEN '-' ELSE SCHEDULED_MOVEMENT_DESTINATION END AS V_DESTINATION, CASE WHEN FORMATTED_EVENT_START_TIME IS NULL THEN '-' ELSE FORMATTED_EVENT_START_TIME END AS V_TIME, CASE WHEN ESCORT_CODE IS NULL THEN '-' ELSE ESCORT_CODE END AS V_ESCORT, CASE WHEN SEAL_MARK IS NULL THEN '-' ELSE SEAL_MARK END AS V_SEAL_MARK, CASE WHEN SUBSTR(DESCRIPTION, 1, 10) = 'Video Link' THEN 'Court Event - Video Link' ELSE EVENT_TYPE_DESCRIPTION END AS V_MOVEMENT_TYPE, CASE WHEN ALERT_DESCRIPTION IN ( 'ACCT Closed (HMPS)', 'ACCT Open (HMPS)', 'ACCT Post Closure (HMPS)' ) THEN 'Y' ELSE 'N' END AS V_ACCT_3M, CASE WHEN ALERT_CODE IN ('XNR') AND ( EXPIRY_DATE >= EVENT_DATE OR EXPIRY_DATE IS NULL ) OR ALERT_DATE <= EVENT_DATE THEN 'X' ELSE '-' END AS NFR, CASE WHEN ALERT_CODE = 'HA' AND ALERT_STATUS='ACTIVE' THEN 'Y' ELSE 'N' END AS V_MAX_ACCT, CASE WHEN ALERT_CODE IN ('HA', 'HA1', 'HA2') THEN 'Y' ELSE 'N' END AS V_PREV_ACCT FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Location LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "schedule_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Schedule Date Start",
          "description": "@prompt('Schedule Date Start','D',,Mono,Free,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "INITIALS",
            "type": "string",
            "display": "Initials",
            "legacyId": "DP3.DO71",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Cell Location",
            "legacyId": "DP3.DO427",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "IMPRISONMENT_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "DP3.DO3c7",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "EVENT_TYPE_DESCRIPTION",
            "type": "string",
            "display": "Event Type Description",
            "legacyId": "DP3.DO8c7",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "EVENT_DATE",
            "type": "date",
            "display": "Event Date",
            "legacyId": "DP3.DO83e",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "FORMATTED_EVENT_START_TIME",
            "type": "string",
            "display": "Formatted Event Start Time",
            "legacyId": "DP3.DO1063",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Scheduled Movement Reason",
            "legacyId": "DP3.DO892",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "SCHEDULED_MOVEMENT_DESTINATION",
            "type": "string",
            "display": "Scheduled Movement Destination",
            "legacyId": "DP3.DO8f4",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ALERT_CODE",
            "type": "string",
            "display": "Alert Type Code",
            "legacyId": "DP3.DO7e",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "EXPIRY_DATE",
            "type": "date",
            "display": "Expiry Date",
            "legacyId": "DP3.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ALERT_DATE",
            "type": "date",
            "display": "Alert Effective Date",
            "legacyId": "DP3.DO59e",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "EVENT_SUB_TYPE",
            "type": "string",
            "display": "Event Sub Type Code",
            "legacyId": "DP3.DO87a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "EVENT_STATUS",
            "type": "string",
            "display": "Event Status",
            "legacyId": "DP3.DO842",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "ESCORT_CODE",
            "type": "string",
            "display": "Escort Code",
            "legacyId": "DP3.DOc93",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "SEAL_MARK",
            "type": "string",
            "display": "Seal Mark",
            "legacyId": "DP3.DOc3c",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ALERT_DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "DP3.DO97",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "ACCT",
            "type": "string",
            "display": "ACCT",
            "legacyId": "DP3.DO585",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "ALERT_STATUS",
            "type": "string",
            "display": "Alert Status",
            "legacyId": "DP3.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "PROFILE_CODE",
            "type": "string",
            "display": "Religion",
            "legacyId": "DP3.DOb0",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "APPROVED_RESULT",
            "type": "string",
            "display": "CSRA Approved Result",
            "legacyId": "DP3.DOc50",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "V_DESTINATION",
            "type": "string",
            "display": "Destination",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 23,
            "name": "V_TIME",
            "type": "string",
            "display": "Time",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 24,
            "name": "V_ESCORT",
            "type": "string",
            "display": "Escort",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 25,
            "name": "V_SEAL_MARK",
            "type": "string",
            "display": "Seal Mark",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 26,
            "name": "V_MOVEMENT_TYPE",
            "type": "string",
            "display": "Movement Type",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 27,
            "name": "V_ACCT_3M",
            "type": "string",
            "display": "ACCT within last 3 months",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 28,
            "name": "NFR",
            "type": "string",
            "display": "NFR",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 29,
            "name": "V_MAX_ACCT",
            "type": "string",
            "display": "Max ACCT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 30,
            "name": "V_PREV_ACCT",
            "type": "string",
            "display": "Previous ACCT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3377299/DPa",
      "name": "ACCT",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_ALERT_TYPE_DESC.DESCRIPTION AS DESCRIPTION, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ALERTS_ACCT, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE) AND (AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND ((AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND AT_ALERT_TYPE_DESC.DESCRIPTION IN ('ACCT Closed (HMPS)', 'ACCT Open (HMPS)', 'ACCT Post Closure (HMPS)'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, ALERTS_ACCT, ALERT_STATUS, EXPIRY_DATE, ALERT_CODE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPa.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "DPa.DO97",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ALERTS_ACCT",
            "type": "string",
            "display": "Alerts.ACCT",
            "legacyId": "DPa.DO585",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ALERT_STATUS",
            "type": "string",
            "display": "Alert Status",
            "legacyId": "DPa.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "EXPIRY_DATE",
            "type": "date",
            "display": "Expiry Date",
            "legacyId": "DPa.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ALERT_CODE",
            "type": "string",
            "display": "Alert Type Code",
            "legacyId": "DPa.DO7e",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": ["${role}", "ROLE_PRISONS_REPORTING_USER"]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "156265.RS",
      "name": "Daily Discharge List",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP3",
      "specification": {
        "template": "list-section",
        "section": ["V_MOVEMENT_TYPE"],
        "field": [
          {
            "name": "$ref:V_MOVEMENT_TYPE",
            "display": "Movement Type",
            "formula": "",
            "visible": "false",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:V_DESTINATION",
            "display": "Destination",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Scheduled Movement Destination]);\"-\";[Scheduled Movement Destination])"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP3.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP3.DO45"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO71"
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO427"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DOb0"
          },
          {
            "name": "$ref:IMPRISONMENT_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO3c7"
          },
          {
            "name": "$ref:APPROVED_RESULT",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DOc50"
          },
          {
            "name": "$ref:NFR",
            "display": "NFR",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([v_NFR_1])>=1 Then \"X\" Else \"\""
          },
          {
            "name": "$ref:V_TIME",
            "display": "Time",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Formatted Event Start Time]);\"-\";[Formatted Event Start Time])"
          },
          {
            "name": "$ref:V_MAX_ACCT",
            "display": "Open ACCT?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Open_ACCT?])"
          },
          {
            "name": "$ref:V_ACCT_3M",
            "display": "ACCT Within Past 3 Months ?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([V_ACCT_Final])>=1 Then \"Y\" Else \"N\""
          },
          {
            "name": "$ref:V_PREV_ACCT",
            "display": "Previous ACCT across Bookings?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Any_prev_ACCTS?])"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Scheduled Movement Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO892"
          },
          {
            "name": "$ref:V_ESCORT",
            "display": "Escort",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Escort Code]);\"-\";[Escort Code])"
          },
          {
            "name": "$ref:V_SEAL_MARK",
            "display": "Ppty",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Seal Mark]);\"-\";[Seal Mark])"
          }
        ]
      }
    },
    {
      "id": "180530.RS",
      "name": "Alternate Format",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP3",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:EVENT_DATE",
            "display": "Event Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO83e"
          },
          {
            "name": "$ref:V_MOVEMENT_TYPE",
            "display": "Movement Type",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(Left([Scheduled Movement Reason];10)=\"Video Link\";\"Court Event - Video Link\";[Event Type Description])"
          },
          {
            "name": "$ref:V_DESTINATION",
            "display": "Destination",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Scheduled Movement Destination]);\"-\";[Scheduled Movement Destination])"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP3.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP3.DO45"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO71"
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO427"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DOb0"
          },
          {
            "name": "$ref:IMPRISONMENT_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO3c7"
          },
          {
            "name": "$ref:APPROVED_RESULT",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DOc50"
          },
          {
            "name": "$ref:NFR",
            "display": "NFR",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([v_NFR_1])>=1 Then \"X\" Else \"\""
          },
          {
            "name": "$ref:V_TIME",
            "display": "Time",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Formatted Event Start Time]);\"-\";[Formatted Event Start Time])"
          },
          {
            "name": "$ref:V_MAX_ACCT",
            "display": "Open ACCT?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Open_ACCT?])"
          },
          {
            "name": "$ref:V_ACCT_3M",
            "display": "ACCT Within Past 3 Months ?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([V_ACCT_Final])>=1 Then \"Y\" Else \"N\""
          },
          {
            "name": "$ref:V_PREV_ACCT",
            "display": "Previous ACCT across Bookings?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Any_prev_ACCTS?])"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Scheduled Movement Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO892"
          },
          {
            "name": "$ref:V_ESCORT",
            "display": "Escort",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Escort Code]);\"-\";[Escort Code])"
          },
          {
            "name": "$ref:V_SEAL_MARK",
            "display": "Ppty",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Seal Mark]);\"-\";[Seal Mark])"
          }
        ]
      }
    },
    {
      "id": "183597.RS",
      "name": "Alternate Format 2",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP3",
      "specification": {
        "template": "list-section",
        "section": ["V_MOVEMENT_TYPE"],
        "field": [
          {
            "name": "$ref:V_MOVEMENT_TYPE",
            "display": "Movement Type",
            "formula": "",
            "visible": "false",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP3.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP3.DO45"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO71"
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO427"
          },
          {
            "name": "$ref:IMPRISONMENT_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO3c7"
          },
          {
            "name": "$ref:APPROVED_RESULT",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DOc50"
          },
          {
            "name": "$ref:NFR",
            "display": "NFR",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([v_NFR_1])>=1 Then \"X\" Else \"\""
          },
          {
            "name": "$ref:V_MAX_ACCT",
            "display": "Open ACCT?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Open_ACCT?])"
          },
          {
            "name": "$ref:V_ACCT_3M",
            "display": "ACCT Within Past 3 Months ?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If Sum([V_ACCT_Final])>=1 Then \"Y\" Else \"N\""
          },
          {
            "name": "$ref:V_PREV_ACCT",
            "display": "Previous ACCT across Bookings?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_Any_prev_ACCTS?])"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Scheduled Movement Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP3.DO892"
          },
          {
            "name": "$ref:V_DESTINATION",
            "display": "Destination",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Scheduled Movement Destination]);\"-\";[Scheduled Movement Destination])"
          }
        ]
      }
    }
  ]
}

{
  "id": "klbUU3EABT5OE_4BAMgAISgWcQA",
  "name": "ORS UAL Records",
  "description": "Those Prisoners who are currently UAL, along with their PNC, Release Date and Prisoner Addresses MOV0039 - v00.00.01 Last Modified: 29/02/2016",
  "metadata": {
    "version": "1.0.0",
    "tags": ["MOV0039  v00.00.01 DPR"]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3376286/DP3",
      "name": "UAL",
      "description": "Sentence",
      "datasource": "nomis",
      "query": "SENTENCE_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AS OFFENDER_BOOK_ID, AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE AS RELEASE_DATE, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, AT_OFFENCES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, OMS_OWNER.OFFENCES AT_OFFENCES, (SELECT OFFENDER_BOOK_ID, MOVEMENT_SEQ, MAX(MOVEMENT_TIME) AS MOVEMENT_TIME, FROM_AGY_LOC_ID FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS WHERE ACTIVE_FLAG = 'Y' GROUP BY OFFENDER_BOOK_ID, MOVEMENT_SEQ, FROM_AGY_LOC_ID) DT_LATEST_EXTERNAL_OUT, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES, OMS_OWNER.OFFENCE_INDICATORS AT_OFFENCE_INDICATORS, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENCES.OFFENCE_CODE = AT_OFFENCE_INDICATORS.OFFENCE_CODE) AND (AT_OFFENCES.STATUTE_CODE (+) = AT_OFFENCE_INDICATORS.STATUTE_CODE) AND (AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID) AND (AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID) AND (AT_OFFENCE_INDICATORS.OFFENCE_CODE = AT_OFFENDER_CHARGES.OFFENCE_CODE) AND (AT_OFFENCE_INDICATORS.STATUTE_CODE (+) = AT_OFFENDER_CHARGES.STATUTE_CODE) AND (AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = AT_MOVEMENT_REASONS.MOVEMENT_TYPE AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE = AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID = (SELECT FROM_AGY_LOC_ID FROM prompt_) AND (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT') AND AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG = 'Y' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND AT_MOVEMENT_REASONS.DESCRIPTION IN ('Abscond', 'Escape', 'ABSCOND END OF CUSTODY LICENCE'))), dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.BIRTH_DATE AS BIRTH_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE AS MOVEMENT_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TIME AS MOVEMENT_TIME, AT_MOVEMENT_REASONS.DESCRIPTION AS DESCRIPTION, COALESCE(AT_EXT_MOV_FROM_AGY.DESCRIPTION, AT_FROM_CITY_CODES.DESCRIPTION, AT_FROM_ADDRESS_ATTENDED.STREET || ' ' || AT_FROM_ADDRESS_ATTENDED.LOCALITY || ' ' || AT_FROM_ADDRESS_ATTENDED.POSTAL_CODE) AS FROM_, AT_OFFENDER_PNC.IDENTIFIER AS IDENTIFIER, AT_MOV_LOC_FROM_OFFND_LOCTION.DESCRIPTION AS MOVEMENT_FROM_ESTABLISHMENT_32, SENTENCE_.RELEASE_DATE AS RELEASE_DATE, SENTENCE_.DESCRIPTION AS OFFENCE_DESCRIPTION, SENTENCE_.IMPRISONMENT_STATUS AS MAIN_LEGAL_STATUS FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_FROM_CITY_CODES, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_EXT_MOV_FROM_AGY, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, ADDRESSES AT_FROM_ADDRESS_ATTENDED, OMS_OWNER.OFFENDER_IDENTIFIERS AT_OFFENDER_PNC, SENTENCE_, (SELECT OFFENDER_BOOK_ID, MOVEMENT_SEQ, MAX(MOVEMENT_TIME) AS MOVEMENT_TIME, FROM_AGY_LOC_ID FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS WHERE ACTIVE_FLAG = 'Y' GROUP BY OFFENDER_BOOK_ID, MOVEMENT_SEQ, FROM_AGY_LOC_ID) DT_LATEST_EXTERNAL_OUT WHERE (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = AT_MOVEMENT_REASONS.MOVEMENT_TYPE AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE = AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_OFFENDER_PNC.IDENTIFIER_TYPE (+) = 'PNC') AND (AT_OFFENDER_PNC.OFFENDER_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (SENTENCE_.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_EXT_MOV_FROM_AGY.AGY_LOC_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_CITY = AT_FROM_CITY_CODES.CODE (+)) AND (AT_FROM_CITY_CODES.DOMAIN = 'CITY' OR AT_FROM_CITY_CODES.DOMAIN IS NULL) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_ADDRESS_ID = AT_FROM_ADDRESS_ATTENDED.ADDRESS_ID (+)) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID = (SELECT FROM_AGY_LOC_ID FROM prompt_) AND (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT') AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND AT_MOVEMENT_REASONS.DESCRIPTION IN ('Abscond', 'Escape', 'ABSCOND END OF CUSTODY LICENCE'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, BIRTH_DATE, MOVEMENT_DATE, MOVEMENT_TIME, DESCRIPTION, FROM_, IDENTIFIER, MOVEMENT_FROM_ESTABLISHMENT_32, MAIN_LEGAL_STATUS AS V_MAIN_LEGAL_STATUS, OFFENCE_DESCRIPTION AS V_OFFENCE, RELEASE_DATE AS V_RELEASE_DATE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "from_agy_loc_id",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter value(s) for Movement From Establishment Name:",
          "description": "@prompt('Enter value(s) for Movement From Establishment Name:','A','External Movements\\Movement From Establishment Name',Multi,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP3.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP3.DO10075",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "MOVEMENT_DATE",
            "type": "date",
            "display": "Movement Date",
            "legacyId": "DP3.DO10837",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Movement Time  (external)",
            "legacyId": "DP3.DO1059a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Movement Reason Description",
            "legacyId": "DP3.DO1083b",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "FROM_",
            "type": "string",
            "display": "From",
            "legacyId": "DP3.DO10d98",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "IDENTIFIER",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DP3.DO10b9b",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "MOVEMENT_FROM_ESTABLISHMENT_32",
            "type": "string",
            "display": "Movement From Establishment Name",
            "legacyId": "DP3.DO10d7e",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "V_MAIN_LEGAL_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 11,
            "name": "V_OFFENCE",
            "type": "string",
            "display": "Main Offence",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 12,
            "name": "V_RELEASE_DATE",
            "type": "string",
            "display": "Release Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376286/DPd",
      "name": "Sentences",
      "description": "Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE AS RELEASE_DATE, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, AT_OFFENCES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, OMS_OWNER.OFFENCES AT_OFFENCES, (SELECT OFFENDER_BOOK_ID, MOVEMENT_SEQ, MAX(MOVEMENT_TIME) AS MOVEMENT_TIME, FROM_AGY_LOC_ID FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS WHERE ACTIVE_FLAG = 'Y' GROUP BY OFFENDER_BOOK_ID, MOVEMENT_SEQ, FROM_AGY_LOC_ID) DT_LATEST_EXTERNAL_OUT, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES, OMS_OWNER.OFFENCE_INDICATORS AT_OFFENCE_INDICATORS, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENCES.OFFENCE_CODE = AT_OFFENCE_INDICATORS.OFFENCE_CODE) AND (AT_OFFENCES.STATUTE_CODE (+) = AT_OFFENCE_INDICATORS.STATUTE_CODE) AND (AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID) AND (AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID) AND (AT_OFFENCE_INDICATORS.OFFENCE_CODE = AT_OFFENDER_CHARGES.OFFENCE_CODE) AND (AT_OFFENCE_INDICATORS.STATUTE_CODE (+) = AT_OFFENDER_CHARGES.STATUTE_CODE) AND (AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = AT_MOVEMENT_REASONS.MOVEMENT_TYPE AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE = AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID = (SELECT FROM_AGY_LOC_ID FROM prompt_) AND (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT') AND AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG = 'Y' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND AT_MOVEMENT_REASONS.DESCRIPTION IN ('Abscond', 'Escape', 'ABSCOND END OF CUSTODY LICENCE'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, RELEASE_DATE, IMPRISONMENT_STATUS, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "from_agy_loc_id",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter value(s) for Movement From Establishment Name:",
          "description": "@prompt('Enter value(s) for Movement From Establishment Name:','A','External Movements\\Movement From Establishment Name',Multi,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPd.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPd.DO109aa",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "IMPRISONMENT_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "DPd.DO103c7",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Offence Description",
            "legacyId": "DPd.DO974",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DPe",
      "name": "Addresses",
      "description": "Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER_ADDRESSES.FLAT AS FLAT, AT_OFFENDER_ADDRESSES.STREET AS STREET, AT_OFFENDER_ADDRESSES.LOCALITY AS LOCALITY, AT_OFFENDER_ADDRESSES.POSTAL_CODE AS POSTAL_CODE, AT_OFF_ADD_COUNTY.DESCRIPTION AS DESCRIPTION, AT_OFF_ADD_CITY.DESCRIPTION AS CITY_DESCRIPTION, AT_OFFENDER_ADDRESSES.NO_FIXED_ADDRESS_FLAG AS NO_FIXED_ADDRESS_FLAG, AT_OFFENDER_ADDRESSES.PRIMARY_FLAG AS PRIMARY_FLAG, AT_OFFENDER_ADDRESSES.START_DATE AS START_DATE, AT_OFFENDER_ADDRESS_USAGES.ACTIVE_FLAG AS ACTIVE_FLAG, AT_ADDRESS_TYPES.DESCRIPTION AS ADDRESS_DESCRIPTION, AT_OFFENDER_ADDRESSES.CREATE_DATETIME AS CREATE_DATETIME FROM OMS_OWNER.ADDRESSES AT_OFFENDER_ADDRESSES, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_OFF_ADD_COUNTY, OMS_OWNER.REFERENCE_CODES AT_OFF_ADD_CITY, OMS_OWNER.REFERENCE_CODES AT_ADDRESS_TYPES, OMS_OWNER.ADDRESS_USAGES AT_OFFENDER_ADDRESS_USAGES, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, (SELECT OFFENDER_BOOK_ID, MOVEMENT_SEQ, MAX(MOVEMENT_TIME) AS MOVEMENT_TIME, FROM_AGY_LOC_ID FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS WHERE ACTIVE_FLAG = 'Y' GROUP BY OFFENDER_BOOK_ID, MOVEMENT_SEQ, FROM_AGY_LOC_ID) DT_LATEST_EXTERNAL_OUT WHERE (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ADDRESSES.OWNER_ID (+) = AT_OFFENDER.ROOT_OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_ADDRESS_USAGES.ADDRESS_ID (+) = AT_OFFENDER_ADDRESSES.ADDRESS_ID) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = AT_MOVEMENT_REASONS.MOVEMENT_TYPE AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE = AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE) AND (AT_OFF_ADD_CITY.CODE (+) = AT_OFFENDER_ADDRESSES.CITY_CODE) AND (AT_OFF_ADD_CITY.DOMAIN = 'CITY' OR AT_OFF_ADD_CITY.DOMAIN IS NULL) AND (AT_OFF_ADD_COUNTY.CODE (+) = AT_OFFENDER_ADDRESSES.COUNTY_CODE) AND (AT_OFF_ADD_COUNTY.DOMAIN = 'COUNTY' OR AT_OFF_ADD_COUNTY.DOMAIN IS NULL) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND (AT_ADDRESS_TYPES.DOMAIN = 'ADDRESS_TYPE') AND (AT_ADDRESS_TYPES.CODE = AT_OFFENDER_ADDRESS_USAGES.ADDRESS_USAGE) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID = (SELECT FROM_AGY_LOC_ID FROM prompt_)) AND (DT_LATEST_EXTERNAL_OUT.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID AND DT_LATEST_EXTERNAL_OUT.MOVEMENT_SEQ = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_SEQ AND DT_LATEST_EXTERNAL_OUT.FROM_AGY_LOC_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT') AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND AT_MOVEMENT_REASONS.DESCRIPTION IN ('Abscond', 'Escape', 'ABSCOND END OF CUSTODY LICENCE') AND AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID = (SELECT FROM_AGY_LOC_ID FROM prompt_)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, FLAT, STREET, LOCALITY, POSTAL_CODE, DESCRIPTION, CITY_DESCRIPTION, NO_FIXED_ADDRESS_FLAG, PRIMARY_FLAG, START_DATE, ACTIVE_FLAG, ADDRESS_DESCRIPTION, CREATE_DATETIME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "from_agy_loc_id",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter value(s) for Movement From Establishment Name:",
          "description": "@prompt('Enter value(s) for Movement From Establishment Name:','A','External Movements\\Movement From Establishment Name',Multi,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPe.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DPe.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DPe.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FLAT",
            "type": "string",
            "display": "Flat",
            "legacyId": "DPe.DO10dbc",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "STREET",
            "type": "string",
            "display": "Street",
            "legacyId": "DPe.DO10dbe",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "LOCALITY",
            "type": "string",
            "display": "Locality",
            "legacyId": "DPe.DO10825",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "POSTAL_CODE",
            "type": "string",
            "display": "Postal Code",
            "legacyId": "DPe.DO10dbf",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "County Description",
            "legacyId": "DPe.DO10828",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CITY_DESCRIPTION",
            "type": "string",
            "display": "City Description",
            "legacyId": "DPe.DO10827",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "NO_FIXED_ADDRESS_FLAG",
            "type": "string",
            "display": "No Fixed Address Flag",
            "legacyId": "DPe.DO10826",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "PRIMARY_FLAG",
            "type": "string",
            "display": "Primary Flag",
            "legacyId": "DPe.DO1089e",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "START_DATE",
            "type": "date",
            "display": "Start Date",
            "legacyId": "DPe.DO10a07",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ACTIVE_FLAG",
            "type": "string",
            "display": "Active Flag",
            "legacyId": "DPe.DO1089d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "ADDRESS_DESCRIPTION",
            "type": "string",
            "display": "Address Description",
            "legacyId": "DPe.DO10d7d",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "CREATE_DATETIME",
            "type": "date",
            "display": "Create Datetime",
            "legacyId": "DPe.DO10dbb",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": ["${role}", "ROLE_PRISONS_REPORTING_USER"]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "167005.RS",
      "name": "By Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_DATE",
            "display": "UAL Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From Establishment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_OFFENCE",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_RELEASE_DATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "169241.RS",
      "name": "By Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_DATE",
            "display": "UAL Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From Establishment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_OFFENCE",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_RELEASE_DATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "169305.RS",
      "name": "By Establishment",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_DATE",
            "display": "UAL Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From Establishment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:V_OFFENCE",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_RELEASE_DATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "169055.RS",
      "name": "Addresses",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DPe",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:FLAT",
            "display": "Flat",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:STREET",
            "display": "Street",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false
          },
          {
            "name": "$ref:LOCALITY",
            "display": "Locality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CITY_DESCRIPTION",
            "display": "Town / City",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "County",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:POSTAL_CODE",
            "display": "Post Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NO_FIXED_ADDRESS_FLAG",
            "display": "NFA?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:PRIMARY_FLAG",
            "display": "Primary Address?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:START_DATE",
            "display": "Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ADDRESS_DESCRIPTION",
            "display": "Address Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CREATE_DATETIME",
            "display": "Create Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "168008.RS",
      "name": "Summary",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:FROM_",
            "display": "From Establishment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Movement Reason Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    }
  ]
}

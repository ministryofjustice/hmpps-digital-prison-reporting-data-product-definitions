{
  "id": "klZNnV0ACxcxKAgA97wAISgWcQA",
  "name": "ORS Alternative Unlock List",
  "description": "MOV0036 - v00.01.01 Last Modified: 18/11/15\nThis is an unlock list showing all cells and prisoners  and any movements scheduled for a day, grouped into AM, PM and ED. Best run the previous day e.g by night staff for the next day.",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "MOV0036 v00.01.01 DPR"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP7",
      "name": "Prisoners to Unlock",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, 'Activity' AS SA_EVENT_TYPE, AT_ACTY_INTLOC.DESCRIPTION AS DESCRIPTION, DT_ACT_SCHEDULE.ALT_START AS ALT_START, DT_ACT_SCHEDULE.SLOT_CATEGORY_CODE AS SLOT_CATEGORY_CODE, AT_OFF_COURSE_EVENTS.DESCRIPTION AS SA_ACTIVITY_DESC_ FROM (SELECT crs_sch_id, crs_acty_id, schedule_date, start_time, end_time, TO_CHAR(start_time, 'HH24:MI') AS ALT_START, TO_CHAR(end_time, 'HH24:MI') AS ALT_END, session_no, catch_up_crs_sch_id, slot_category_code FROM oms_owner.course_schedules WHERE catch_up_crs_sch_id IS NULL) DT_ACT_SCHEDULE, OMS_OWNER.V_OFFENDER_COURSE_EVENTS_2 AT_OFF_COURSE_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_ACTY_INTLOC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_ACTY_ESTAB, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (AT_ACTY_ESTAB.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFF_COURSE_EVENTS.CRS_SCH_ID = DT_ACT_SCHEDULE.CRS_SCH_ID) AND (AT_OFF_COURSE_EVENTS.CRS_ACTY_ID = DT_ACT_SCHEDULE.CRS_ACTY_ID) AND (AT_OFF_COURSE_EVENTS.TO_INTERNAL_LOCATION_ID = AT_ACTY_INTLOC.INTERNAL_LOCATION_ID (+)) AND (AT_OFF_COURSE_EVENTS.AGY_LOC_ID = AT_ACTY_ESTAB.AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFF_COURSE_EVENTS.OFFENDER_BOOK_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFF_COURSE_EVENTS.EVENT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_ACTY_ESTAB.AGY_LOC_ID = 'HEI') UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, 'Court' AS SA_EVENT_TYPE, AT_DESTINATION_COURT.DESCRIPTION AS DESCRIPTION, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_DESTINATION_COURT, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.COURT_EVENTS AT_COURT_EVENT_MVMTS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_COURT_EVENT_MVMTS.OFFENDER_BOOK_ID) AND (AT_COURT_EVENT_MVMTS.AGY_LOC_ID = AT_DESTINATION_COURT.AGY_LOC_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_COURT_EVENT_MVMTS.EVENT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_COURT_EVENT_MVMTS.EVENT_STATUS = 'SCH') UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, 'Hearing' AS SA_EVENT_TYPE, AT_HEARING_LOC.DESCRIPTION AS DESCRIPTION, TO_CHAR(AT_OIC_HEARINGS.HEARING_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_OIC_HEARINGS.HEARING_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_ACTY_ESTAB2, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_HEARING_LOC, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.OIC_HEARINGS AT_OIC_HEARINGS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.V_OIC_INCIDENTS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = OMS_OWNER.V_OIC_INCIDENTS.OFFENDER_BOOK_ID) AND (AT_OIC_HEARINGS.INTERNAL_LOCATION_ID = AT_HEARING_LOC.INTERNAL_LOCATION_ID) AND (AT_HEARING_LOC.AGY_LOC_ID = AT_ACTY_ESTAB2.AGY_LOC_ID) AND (AT_ACTY_ESTAB2.AGENCY_LOCATION_TYPE = 'INST') AND (OMS_OWNER.V_OIC_INCIDENTS.OIC_INCIDENT_ID = AT_OIC_HEARINGS.OIC_INCIDENT_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND TO_DATE(TO_CHAR(TRUNC(AT_OIC_HEARINGS.HEARING_TIME), 'dd/mm/yyyy'), 'dd/mm/yyyy') = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_ACTY_ESTAB2.AGY_LOC_ID = 'HEI') UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, 'Release' AS SA_EVENT_TYPE, '- ' AS DESCRIPTION, '' AS ALT_START, 'AM' AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND (AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */) UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, 'Visit' AS SA_EVENT_TYPE, AT_VISIT_LOCATION.DESCRIPTION AS DESCRIPTION, TO_CHAR(AT_OFFENDER_VISITS.START_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_OFFENDER_VISITS.START_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_VISIT_LOCATION, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.OFFENDER_VISITS AT_OFFENDER_VISITS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_VISITS.OFFENDER_BOOK_ID) AND (AT_OFFENDER_VISITS.VISIT_INTERNAL_LOCATION_ID = AT_VISIT_LOCATION.INTERNAL_LOCATION_ID) AND (AT_OFFENDER_VISITS.VISIT_STATUS = 'SCH') AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFFENDER_VISITS.VISIT_STATUS = 'SCH' AND AT_OFFENDER_VISITS.VISIT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE AS SA_EVENT_TYPE, CASE WHEN NOT AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL THEN AT_AGENCY_LOCATIONS_SCH_TO.DESCRIPTION WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND NOT AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL AND DT_ROTL_ADDRESS_USAGE.ADDRESS_USAGE = 'ROTL' THEN CASE WHEN (ROTL_ADDRESSES.FLAT) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.FLAT) END || ' ' || CASE WHEN (ROTL_ADDRESSES.PREMISE) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.PREMISE) || ' ' END || CASE WHEN (ROTL_ADDRESSES.STREET) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.STREET) || ' ' END WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL THEN 'No Location' ELSE AT_CORPORATES.CORPORATE_NAME END AS DESCRIPTION, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM ADDRESSES ROTL_ADDRESSES, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_IND_SCHEDULES AT_OFFENDER_IND_SCHEDULES, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_TO, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM2, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.CORPORATES AT_CORPORATES, (SELECT * FROM ADDRESS_USAGES WHERE ADDRESS_USAGE = 'ROTL') DT_ROTL_ADDRESS_USAGE, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS USER_ACCESSIBLE_CASELOADS_From, V_CORPORATE_ADDRESSES AT_V_CORPORATE_ADDRESSES, ADDRESSES AT_CORPORATE_ADDRESSES WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_IND_SCHEDULES.OFFENDER_BOOK_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_TO.AGY_LOC_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID (+)) AND (USER_ACCESSIBLE_CASELOADS_From.USERNAME = UPPER('CQE98K')) AND (AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS_From.CASELOAD_ID) AND (AT_AGENCY_LOCATIONS_SCH_FROM2.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CORPORATE_ADDRESSES.ADDRESS_ID = AT_V_CORPORATE_ADDRESSES.ADDRESS_ID (+)) AND (AT_V_CORPORATE_ADDRESSES.CORPORATE_ID = AT_CORPORATES.CORPORATE_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = AT_CORPORATE_ADDRESSES.ADDRESS_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = ROTL_ADDRESSES.ADDRESS_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = DT_ROTL_ADDRESS_USAGE.ADDRESS_ID (+)) AND (AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFFENDER_IND_SCHEDULES.DIRECTION_CODE = 'OUT' AND AT_OFFENDER_IND_SCHEDULES.EVENT_STATUS = 'SCH' AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'TAP' AND AT_OFFENDER_IND_SCHEDULES.EVENT_CLASS = 'EXT_MOV' AND AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID = 'HEI' AND (USER_ACCESSIBLE_CASELOADS_From.USERNAME = UPPER('CQE98K'))) UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE AS SA_EVENT_TYPE, CASE WHEN NOT AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL THEN AT_AGENCY_LOCATIONS_SCH_TO.DESCRIPTION WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND NOT AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL AND DT_ROTL_ADDRESS_USAGE.ADDRESS_USAGE = 'ROTL' THEN CASE WHEN (ROTL_ADDRESSES.FLAT) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.FLAT) END || ' ' || CASE WHEN (ROTL_ADDRESSES.PREMISE) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.PREMISE) || ' ' END || CASE WHEN (ROTL_ADDRESSES.STREET) IS NULL THEN NULL ELSE (ROTL_ADDRESSES.STREET) || ' ' END WHEN AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID IS NULL AND AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID IS NULL THEN 'No Location' ELSE AT_CORPORATES.CORPORATE_NAME END AS DESCRIPTION, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM ADDRESSES ROTL_ADDRESSES, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_IND_SCHEDULES AT_OFFENDER_IND_SCHEDULES, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_TO, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM2, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOCATIONS_SCH_FROM, OFFENDER_IND_SCH_WAIT_LISTS AT_OFFENDER_IND_SCH_WAIT_LISTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.CORPORATES AT_CORPORATES, (SELECT * FROM ADDRESS_USAGES WHERE ADDRESS_USAGE = 'ROTL') DT_ROTL_ADDRESS_USAGE, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS USER_ACCESSIBLE_CASELOADS_From, V_CORPORATE_ADDRESSES AT_V_CORPORATE_ADDRESSES, ADDRESSES AT_CORPORATE_ADDRESSES WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_IND_SCHEDULES.OFFENDER_BOOK_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_IND_SCHEDULES.TO_AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_TO.AGY_LOC_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID (+)) AND (USER_ACCESSIBLE_CASELOADS_From.USERNAME = UPPER('CQE98K')) AND (AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS_From.CASELOAD_ID) AND (AT_AGENCY_LOCATIONS_SCH_FROM2.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CORPORATE_ADDRESSES.ADDRESS_ID = AT_V_CORPORATE_ADDRESSES.ADDRESS_ID (+)) AND (AT_V_CORPORATE_ADDRESSES.CORPORATE_ID = AT_CORPORATES.CORPORATE_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = AT_CORPORATE_ADDRESSES.ADDRESS_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = ROTL_ADDRESSES.ADDRESS_ID (+)) AND (AT_OFFENDER_IND_SCHEDULES.TO_ADDRESS_ID = DT_ROTL_ADDRESS_USAGE.ADDRESS_ID (+)) AND (AT_AGENCY_LOCATIONS_SCH_FROM.AGY_LOC_ID = AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_OFFENDER_IND_SCHEDULES.EVENT_ID = AT_OFFENDER_IND_SCH_WAIT_LISTS.EVENT_ID (+)) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'TRN' AND AT_OFFENDER_IND_SCHEDULES.EVENT_CLASS = 'EXT_MOV' AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_OFFENDER_IND_SCHEDULES.EVENT_STATUS = 'SCH' AND AT_OFFENDER_IND_SCHEDULES.DIRECTION_CODE = 'OUT' AND AT_OFFENDER_IND_SCH_WAIT_LISTS.APPROVED_FLAG = 'Y' AND AT_OFFENDER_IND_SCH_WAIT_LISTS.WAIT_LIST_STATUS = 'CON' AND AT_AGENCY_LOCATIONS_SCH_FROM2.AGY_LOC_ID = 'HEI' AND (USER_ACCESSIBLE_CASELOADS_From.USERNAME = UPPER('CQE98K'))) UNION SELECT AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE AS SA_EVENT_TYPE, AT_INTERNAL_LOCATIONS_MVTS.DESCRIPTION AS DESCRIPTION, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'HH24:MI') AS ALT_START, TO_CHAR(AT_OFFENDER_IND_SCHEDULES.START_TIME, 'AM') AS SLOT_CATEGORY_CODE, '' AS SA_ACTIVITY_DESC_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_IND_SCHEDULES AT_OFFENDER_IND_SCHEDULES, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_INTERNAL_LOCATIONS_MVTS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_IND_SCHEDULES.OFFENDER_BOOK_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_IND_SCHEDULES.TO_INTERNAL_LOCATION_ID = AT_INTERNAL_LOCATIONS_MVTS.INTERNAL_LOCATION_ID (+)) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')) AND AT_OFFENDER_IND_SCHEDULES.EVENT_TYPE = 'APP' AND AT_OFFENDER_IND_SCHEDULES.EVENT_DATE = TO_DATE('18-11-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS'))), dataset_ AS (SELECT LAST_NAME, OFFENDER_ID_DISPLAY, FIRST_NAME, UNIT_CODE_1, UNIT_DESCRIPTION_4_SHORT, ACCT, NFR, SA_EVENT_TYPE, DESCRIPTION, ALT_START, SLOT_CATEGORY_CODE, SA_ACTIVITY_DESC_ FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP7.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP7.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP7.DO46",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_CODE_1",
            "type": "string",
            "display": "Unit Code 1",
            "legacyId": "DP7.DO472",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP7.DO427",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ACCT",
            "type": "string",
            "display": "ACCT",
            "legacyId": "DP7.DO585",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "NFR",
            "type": "string",
            "display": "NFR",
            "legacyId": "DP7.DOd6d",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "SA_EVENT_TYPE",
            "type": "string",
            "display": "SA Event Type",
            "legacyId": "DP7.DOcf2",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "SA Internal Location",
            "legacyId": "DP7.DOd21",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "ALT_START",
            "type": "string",
            "display": "Formatted Activity Start Time",
            "legacyId": "DP7.DO105d",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "SLOT_CATEGORY_CODE",
            "type": "string",
            "display": "Slot Category Code",
            "legacyId": "DP7.DO105f",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "SA_ACTIVITY_DESC_",
            "type": "string",
            "display": "SA Activity Desc.",
            "legacyId": "DP7.DOcfa",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DP13",
      "name": "All Prisoners",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.LAST_NAME AS LAST_NAME, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS ACCT, CASE WHEN MAX(CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'XNR' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'X' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END) OVER (PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID)) = 2 THEN 'Y' ELSE 'N' END AS NFR, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1) END - 1) END AS UNIT_CODE_1, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2) END - 1) END AS UNIT_CODE_2, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) + 1, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 4) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 4) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) END - 1) END AS UNIT_CODE_3, CASE WHEN INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 4) = 0 THEN NULL ELSE SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 4) + 1, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) - INSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 3) - 1) END AS UNIT_CODE_4 FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('CQE98K')) AND ((AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'HEI') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, FIRST_NAME, LAST_NAME, ACCT, NFR, UNIT_CODE_1, UNIT_DESCRIPTION_4_SHORT, UNIT_CODE_2, UNIT_CODE_3, UNIT_CODE_4, CASE WHEN V_EVENTTYPE = 'TAP' THEN 'Temp Absence' ELSE CASE WHEN V_EVENTTYPE = 'TRN' THEN 'Transfer' ELSE CASE WHEN V_EVENTTYPE = 'APP' THEN 'Appointment' ELSE CASE WHEN V_EVENTTYPE = 'Prison Activity' THEN 'Activity' ELSE CASE WHEN V_EVENTTYPE = 'Court Event' THEN 'Court' ELSE V_EVENTTYPE END END END END END AS v_Reason, CASE WHEN V_EVENTTYPE = 'Activity' THEN V_ACTIVITYDESC ELSE V_LOCATION END AS v_Destination_Activity FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP13.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP13.DO46",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP13.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ACCT",
            "type": "string",
            "display": "ACCT",
            "legacyId": "DP13.DO585",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "NFR",
            "type": "string",
            "display": "NFR",
            "legacyId": "DP13.DOd6d",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "UNIT_CODE_1",
            "type": "string",
            "display": "Unit Code 1",
            "legacyId": "DP13.DO472",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP13.DO427",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "UNIT_CODE_2",
            "type": "string",
            "display": "Unit Code 2",
            "legacyId": "DP13.DO471",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "UNIT_CODE_3",
            "type": "string",
            "display": "Unit Code 3",
            "legacyId": "DP13.DO46d",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "UNIT_CODE_4",
            "type": "string",
            "display": "Unit Code 4",
            "legacyId": "DP13.DO46e",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "v_Reason",
            "type": "string",
            "display": "v_Reason",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 11,
            "name": "v_Destination_Activity",
            "type": "string",
            "display": "v_Destination_Activity",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "173595.RS",
      "name": "By Spur AM",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP13",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (UNIT_CODE_1 NOT(IN ('COURT','TAP','CSWAP','ECL','RECP')) AND (SLOT_CATEGORY_CODE = 'AM' OR SLOT_CATEGORY_CODE IS NULL)))"
      },
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:UNIT_CODE_3",
            "display": "Unit Code 3",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_2",
            "display": "Unit Code 2",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_4",
            "display": "Unit Code 4",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Reason",
            "display": "",
            "formula": "=If([v_EventType]=\"TAP\";\"Temp Absence\";If([v_EventType]=\"TRN\";\"Transfer\";If([v_EventType]=\"APP\";\"Appointment\";If([v_EventType]=\"Prison Activity\";\"Activity\";If([v_EventType]=\"Court Event\";\"Court\";[v_EventType])))))",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Destination_Activity",
            "display": "",
            "formula": "=If([v_EventType]=\"Activity\";[v_ActivityDesc];[v_Location])",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "173646.RS",
      "name": "By Spur PM",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP13",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (UNIT_CODE_1 NOT(IN ('RECP','COURT','CSWAP','ECL','TAP')) AND (SLOT_CATEGORY_CODE IS NULL OR SLOT_CATEGORY_CODE = 'PM')))"
      },
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:UNIT_CODE_3",
            "display": "Unit Code 3",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_2",
            "display": "Unit Code 2",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_4",
            "display": "Unit Code 4",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Reason",
            "display": "",
            "formula": "=If([v_EventType]=\"TAP\";\"Temp Absence\";If([v_EventType]=\"TRN\";\"Transfer\";If([v_EventType]=\"APP\";\"Appointment\";If([v_EventType]=\"Prison Activity\";\"Activity\";If([v_EventType]=\"Court Event\";\"Court\";[v_EventType])))))",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Destination_Activity",
            "display": "",
            "formula": "=If([v_EventType]=\"Activity\";[v_ActivityDesc];[v_Location])",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "173697.RS",
      "name": "By Spur ED",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP13",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (UNIT_CODE_1 NOT(IN ('TAP','CSWAP','ECL','RECP','COURT')) AND (SLOT_CATEGORY_CODE IS NULL OR SLOT_CATEGORY_CODE = 'ED')))"
      },
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:UNIT_CODE_3",
            "display": "Unit Code 3",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_2",
            "display": "Unit Code 2",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_CODE_4",
            "display": "Unit Code 4",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Reason",
            "display": "",
            "formula": "=If([v_EventType]=\"TAP\";\"Temp Absence\";If([v_EventType]=\"TRN\";\"Transfer\";If([v_EventType]=\"APP\";\"Appointment\";If([v_EventType]=\"Prison Activity\";\"Activity\";If([v_EventType]=\"Court Event\";\"Court\";[v_EventType])))))",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:v_Destination_Activity",
            "display": "",
            "formula": "=If([v_EventType]=\"Activity\";[v_ActivityDesc];[v_Location])",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    }
  ]
}